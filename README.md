## KinematicBody

* 位移
    * 位移分为贴地位移与一般位移，两者的结算方式不同
    * 贴地位移指处于贴地、开启重力、无Y轴运动的情况
    * 一般位移除外
* 碰撞判定
    * 用胶囊体射线
        * 可以解决，但是本体部分不存在判定
        * 佐以本体检测？
            * 可行
* 重叠处理
    * 强制设置坐标或重启碰撞后本体检测，取最近坐标
* 滑动
    * 一般的平墙不想滑，圆球啥的想滑
    * 根据胶囊体射线产生hit的法线决定偏向
* 落地判定
    * 胶囊体射线判断距离
    * 配合万有引力
* 踩踏滑落
    * 为该类碰撞体标注物理材质，作反方向推移
* 斜坡处理
    * 处于地面且无Y方向的移动，方向根据地面角度作旋转处理，地面角度非法时作反方向移动
* 上楼梯
    * 无Y方向的移动失败时朝上坐标再度尝试

### 流程

* 接收各路逻辑的位移信息
* 若被设置了坐标，清空位移信息，执行重叠判定
* 若开启了碰撞，执行重叠判定
* 若贴地
    * 地面存在物理材质，发出回调，让业务端做进一步处理（清空位移信息，作上方向+反方向位移）
    * 若不存在物理材质且处于不合法角度，发出回调，让业务端做进一步处理（瞬移回安全坐标）
    * 若合适，记录安全坐标
* 结算位移
    * 贴地位移
        * 根据地面方向改变方向
            * 若地面角度不合法则终止
        * 根据方向发射胶囊体
            * 若无命中，则设置坐标
        * 判断命中角度，若处于合法角度
            * 设置坐标，根据剩余移动距离再作移动
        * 向上抬高后重新发射胶囊体
            * 若无命中，则设置坐标
            * 作出标记，判断贴地时若小于抬高度则直接贴地
        * 若命中则以命中坐标为准
    * 一般位移
        * 根据方向发射胶囊体
            * 若无命中，则设置坐标
        * 若命中则以命中坐标为准
* 判断贴地
    * 向下发射胶囊体
    * 若小于一定距离则视为贴地
        * 若发生过抬高则按抬高值，否则为默认值
    * 根据命中情况确定地面坐标
    * 若触发不贴地，发出回调，让业务端做进一步处理（启动万有引力）

### 实验

* 测试胶囊体射线，模拟一般位移的情况
* 结合贴地与斜坡、楼梯，模拟贴地位移的情况
* 测试贴地射线，模拟贴地的情况
* 重叠判定坐标点模拟
* 设置坐标模拟